<!DOCTYPE html>
<html>
<head>
  <title>CRT Screener</title>
</head>

<body>

<h2>CRT Screener</h2>

<select id="tf">
  <option value="daily">Daily</option>
  <option value="weekly">Weekly</option>
  <option value="monthly">Monthly</option>
</select>

<br><br>

<button onclick="runScan()">Run Scan</button>

<h3>Results</h3>

<table border="1" cellpadding="8" style="margin-top:10px;">
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Timeframe</th>
      <th>Status</th>
      <th>Chart</th>
    </tr>
  </thead>
  <tbody id="result"></tbody>
</table>

<h3>Chart</h3>

<div id="tvChart"></div>

<!-- TradingView Library -->
<script src="https://s3.tradingview.com/tv.js"></script>

<script>
let tvWidget;

function loadChart(symbol, interval) {
  if (tvWidget) {
    tvWidget.remove();
  }

  tvWidget = new TradingView.widget({
    width: "100%",
    height: 500,
    symbol: symbol,
    interval: interval,
    timezone: "Asia/Kolkata",
    theme: "light",
    style: "1",
    locale: "en",
    container_id: "tvChart"
  });
}
<script>
function runScan() {
  const tf = document.getElementById("tf").value;

  const intervalMap = {
    daily: "D",
    weekly: "W",
    monthly: "M"
  };

  const symbols = [
    { name: "XAUUSD", tv: "OANDA:XAUUSD" },
    { name: "XAGUSD", tv: "OANDA:XAGUSD" },
    { name: "US500", tv: "OANDA:SPX500USD" }
  ];

  const tbody = document.getElementById("result");
  tbody.innerHTML = "";

  symbols.forEach(symbol => {
    fetch("https://crt-screener-backend-rnoo.vercel.app/scan?tf=" + tf)
      .then(res => res.json())
      .then(data => {
        const row = document.createElement("tr");

        row.innerHTML = `
          <td>${symbol.name}</td>
          <td>${data.timeframe}</td>
          <td>${data.status}</td>
          <td>
            <button onclick="loadChart('${symbol.tv}', '${intervalMap[tf]}')">
              ðŸ“ˆ View
            </button>
          </td>
        `;

        tbody.appendChild(row);
      });
  });
}
</script>


  // Load chart
  loadChart("FOREXCOM:XAUUSD", intervalMap[tf]);

  // Call backend
  fetch("https://crt-screener-backend-rnoo.vercel.app/scan?tf=" + tf)
    .then(res => res.json())
    .then(data => {
      document.getElementById("result").innerHTML = `
        <tr>
          <td>XAUUSD</td>
          <td>${data.timeframe}</td>
          <td>${data.status}</td>
          <td>
            <a href="https://www.tradingview.com/chart/?symbol=FX:XAUUSD"
               target="_blank">ðŸ“ˆ View</a>
          </td>
        </tr>
      `;
    })
    .catch(() => {
      document.getElementById("result").innerHTML =
        "<tr><td colspan='4'>Backend error</td></tr>";
    });
}
</script>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>CRT Screener</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    h1 {
      margin-bottom: 10px;
    }

    button {
      padding: 6px 12px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: #fff;
      margin-top: 15px;
    }

    th, td {
      padding: 10px;
      border-bottom: 1px solid #ddd;
      text-align: center;
    }

    th {
      background: #111;
      color: white;
    }

    .btn-view {
      padding: 5px 10px;
      border: 1px solid #444;
      background: #fff;
      cursor: pointer;
    }

    .option-a {
      color: green;
      font-weight: bold;
    }

    .option-b {
      color: red;
      font-weight: bold;
    }

    #chart {
      margin-top: 20px;
      height: 500px;
      background: white;
    }
  </style>
</head>

<body>

  <h1>CRT Screener</h1>

  <select id="timeframe">
    <option value="daily">Daily</option>
    <option value="4h">4H</option>
    <option value="1h">1H</option>
  </select>

  <button onclick="runScan()">Run Scan</button>

  <table>
    <thead>
      <tr>
        <th>Symbol</th>
        <th>Timeframe</th>
        <th>Status</th>
        <th>Chart</th>
      </tr>
    </thead>
    <tbody id="results"></tbody>
  </table>

  <div id="chart"></div>

  <script>
    const API_URL = "https://crt-screener-backend.onrender.com/scan";

    async function runScan() {
      const tf = document.getElementById("timeframe").value;
      const tbody = document.getElementById("results");

      tbody.innerHTML = "<tr><td colspan='4'>Scanning...</td></tr>";

      const res = await fetch(`${API_URL}?timeframe=${tf}`);
      const data = await res.json();

      tbody.innerHTML = "";

      data.forEach(row => {
        const tr = document.createElement("tr");

        const typeClass =
          row.type === "OPTION_A_CONTINUATION" ? "option-a" :
          row.type === "OPTION_B_REVERSAL" ? "option-b" : "";

        tr.innerHTML = `
          <td>${row.symbol}</td>
          <td>${row.timeframe}</td>
          <td class="${typeClass}">
            ${row.type.replaceAll("_", " ")}
          </td>
          <td>
            <button class="btn-view" onclick="openChart('${row.symbol}')">
              View
            </button>
          </td>
        `;

        tbody.appendChild(tr);
      });
    }

    function openChart(symbol) {
      document.getElementById("chart").innerHTML = `
        <iframe
          src="https://www.tradingview.com/widgetembed/?symbol=${symbol}&interval=D&theme=light"
          width="100%"
          height="100%"
          frameborder="0"
          allowfullscreen>
        </iframe>
      `;
    }
  </script>

</body>
</html>


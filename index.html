<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>CRT Screener</title>

<style>
:root {
  --dark: #111;
  --blue: #0b5ed7;
  --light: #f5f7fa;
  --border: #ddd;
}

body {
  margin: 0;
  font-family: Segoe UI, Arial, sans-serif;
  background: var(--light);
}

header {
  background: var(--dark);
  color: white;
  padding: 15px 20px;
  font-size: 20px;
  display: flex;
  justify-content: space-between;
}

.badge {
  background: var(--blue);
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
}

.controls {
  background: white;
  padding: 12px 20px;
  display: flex;
  gap: 10px;
  align-items: center;
  border-bottom: 1px solid var(--border);
}

select, button {
  padding: 8px 12px;
  font-size: 14px;
}

button {
  background: var(--blue);
  color: white;
  border: none;
  cursor: pointer;
}

button:hover { opacity: .9; }

.container { padding: 0 20px; }

table {
  width: 100%;
  border-collapse: collapse;
  background: white;
  margin-top: 10px;
}

thead {
  background: black;
  color: white;
  position: sticky;
  top: 0;
}

th, td {
  padding: 10px;
  border-bottom: 1px solid var(--border);
  font-size: 14px;
}

tbody tr:hover { background: #eef3ff; }

.bull { color: green; font-weight: bold; }
.bear { color: red; font-weight: bold; }

.status {
  text-align: center;
  padding: 25px;
  color: #666;
}
</style>
</head>

<body>

<header>
  CRT Screener Dashboard
  <span class="badge" id="count">0</span>
</header>

<div class="controls">
  <select id="tf">
    <option value="daily">Daily</option>
    <option value="weekly">Weekly</option>
    <option value="monthly">Monthly</option>
  </select>

  <select id="filter">
    <option value="all">All CRT</option>
    <option value="bull">Bullish CRT</option>
    <option value="bear">Bearish CRT</option>
  </select>

  <button onclick="scan()">Run Scan</button>
</div>

<div class="container">
<table>
<thead>
<tr>
  <th>Symbol</th>
  <th>TF</th>
  <th>CRT Type</th>
  <th>Chart</th>
</tr>
</thead>

<tbody id="rows">
<tr>
  <td colspan="4" class="status">Click Run Scan</td>
</tr>
</tbody>
</table>
</div>

<script>
const API = "https://YOUR_BACKEND_URL";

async function scan() {
  const tf = tfSelect.value;
  const filter = filterSelect.value;
  rows.innerHTML = `<tr><td colspan="4" class="status">Scanning...</td></tr>`;
  count.innerText = "â€¦";

  try {
    const res = await fetch(`${API}/scan?tf=${tf}`);
    const data = await res.json();

    let results = data.results || [];

    if (filter === "bull")
      results = results.filter(r => r.type.toLowerCase().includes("bull"));

    if (filter === "bear")
      results = results.filter(r => r.type.toLowerCase().includes("bear"));

    count.innerText = results.length;

    if (results.length === 0) {
      rows.innerHTML = `<tr><td colspan="4" class="status">No CRT found</td></tr>`;
      return;
    }

    rows.innerHTML = "";
    results.forEach(r => {
      const cls = r.type.toLowerCase().includes("bull") ? "bull" : "bear";
      rows.innerHTML += `
        <tr>
          <td>${r.symbol}</td>
          <td>${r.timeframe}</td>
          <td class="${cls}">${r.type}</td>
          <td>
            <a target="_blank"
               href="https://www.tradingview.com/chart/?symbol=${r.symbol}">
              View
            </a>
          </td>
        </tr>`;
    });

  } catch {
    rows.innerHTML = `<tr><td colspan="4" class="status">Backend error</td></tr>`;
  }
}

const tfSelect = document.getElementById("tf");
const filterSelect = document.getElementById("filter");
const rows = document.getElementById("rows");
const count = document.getElementById("count");
</script>

</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>CRT Screener</title>
</head>

<body>

<h2>CRT Screener</h2>

<select id="tf">
  <option value="daily">Daily</option>
  <option value="weekly">Weekly</option>
  <option value="monthly">Monthly</option>
</select>

<br><br>

<button onclick="runScan()">Run Scan</button>

<h3>Results</h3>

<table border="1" cellpadding="8" style="margin-top:10px;">
  <thead>
    <tr>
      <th>Symbol</th>
      <th>Timeframe</th>
      <th>Status</th>
      <th>Chart</th>
    </tr>
  </thead>
  <tbody id="result">
  </tbody>
</table>

<h3>Chart</h3>

<iframe
  id="tvChart"
  src="https://www.tradingview.com/chart/?symbol=FX:XAUUSD"
  width="100%"
  height="500"
  style="border:0;">
</iframe>

<script>
function runScan() {
  const tf = document.getElementById("tf").value;

  // Update TradingView chart
  document.getElementById("tvChart").src =
    "https://www.tradingview.com/chart/?symbol=FX:XAUUSD&interval=" + tf;

  // Call backend
  fetch("https://crt-screener-backend-rnoo.vercel.app/scan?tf=" + tf)
    .then(response => response.json())
    .then(data => {
      const tbody = document.getElementById("result");

      tbody.innerHTML = `
        <tr>
          <td>XAUUSD</td>
          <td>${data.timeframe}</td>
          <td>${data.status}</td>
          <td>
            <a href="https://www.tradingview.com/chart/?symbol=FX:XAUUSD"
               target="_blank">ðŸ“ˆ View</a>
          </td>
        </tr>
      `;
    })
    .catch(error => {
      document.getElementById("result").innerHTML =
        "<tr><td colspan='4'>Backend error</td></tr>";
    });
}
</script>

</body>
</html>

